import { pathToRegexp } from 'path-to-regexp';
import qs from 'qs';
// Adapted from https://github.com/expressjs/express/blob/master/lib/router/layer.js
export function getRequestProperties(pattern, req) {
    const { url = '/' } = req;
    const [pathname, search] = url.split('?');
    const keys = [];
    const regexp = pathToRegexp(pattern, keys);
    const matched = regexp.exec(pathname);
    const params = {};
    if (matched) {
        const query = qs.parse(search);
        for (let i = 1; i < matched.length; i++) {
            const key = keys[i - 1];
            const prop = key.name;
            const val = decode_param(matched[i]);
            if (val !== undefined || !Object.hasOwnProperty.call(params, prop)) {
                params[prop] = val;
            }
        }
        return {
            url,
            params,
            query,
        };
    }
    return;
}
/**
 * Check if the target environment is supported by the application
 *
 * @param environmentConfig - environment property from app config
 * @param targetEnvironment - environment value from module uri
 * @returns boolean
 */
export function isSupportedEnvironment(environmentConfig, targetEnvironment) {
    if (!!targetEnvironment &&
        targetEnvironment !== environmentConfig?.default &&
        !environmentConfig?.supported?.includes(targetEnvironment)) {
        return false;
    }
    return true;
}
function decode_param(val) {
    if (typeof val !== 'string' || val.length === 0) {
        return val;
    }
    return decodeURIComponent(val);
}
//# sourceMappingURL=utils.js.map