import { getInstrumentation } from 'o11y/client';
import { PerformanceApiSink } from './performanceApiSink'; // Check if the Performance API is available
// e.g. JSDom (used in Jest) doesn't implement these

const isPerfSupported = typeof globalThis.performance !== 'undefined' && typeof globalThis.performance.mark === 'function';
const clientBootstrapConfig = globalThis.LWR;

const noop = () => {// noop
};

const noopSink = {
  track: noop
};
const NAMESPACE = 'lwrjs';
/**
 * Sets up o11y instrumentation instance.
 */

export default function hookO11yClient(serviceApi) {
  const instrumentation = getInstrumentation(NAMESPACE);
  const metricsConfig = clientBootstrapConfig.metricsConfig || {};
  const sink = isPerfSupported ? new PerformanceApiSink(instrumentation, metricsConfig) : noopSink;
  sink.track();
}